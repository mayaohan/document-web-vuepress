(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{358:function(s,t,n){"use strict";n.r(t);var a=n(1),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"从一道面试题说起"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从一道面试题说起"}},[s._v("#")]),s._v(" 从一道面试题说起")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"函数调用栈、宏任务-macro-task-队列和微任务-micro-task-队列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数调用栈、宏任务-macro-task-队列和微任务-micro-task-队列"}},[s._v("#")]),s._v(" 函数调用栈、宏任务（macro-task)队列和微任务(micro-task)队列")]),s._v(" "),t("p",[s._v("当引擎第一次遇到 JS 代码时，会产生一个全局执行上下文并压入调用栈。后面每遇到一个函数调用，就会往栈中压入一个新的函数上下文。JS引擎会执行栈顶的函数，执行完毕后，弹出对应的上下文")]),s._v(" "),t("p",[s._v("一句话：如果你有一坨需要被执行的逻辑，它首先需要被推入函数调用栈，后续才能被执行。函数调用栈是个干活的地方，它会真刀真枪地给你执行任务。")]),s._v(" "),t("p",[s._v("那么问题来了！宏任务队列、微任务队列又是啥？")]),s._v(" "),t("p",[s._v("JS 的特性就是单线程+异步。在JS中，咱们有一些任务，比如说上面咱们塞进 "),t("code",[s._v("setTimeout")]),s._v(" 里那个任务，再比如说你在 Promise 里面塞进 then 里面那个任务——这些任务是异步的，它们不需要立刻被执行，所以它们在刚刚被派发的时候，并不具备进入调用栈的“资格”。")]),s._v(" "),t("p",[s._v("这暂时没资格咋整呢？\n排队等呗！\n于是这些待执行的任务，按照一定的规则，乖乖排起长队，等待着被推入调用栈的时刻到来——这个队列，就叫做“任务队列”。")]),s._v(" "),t("p",[s._v("所谓“宏任务”与“微任务”，是对任务的进一步细分。")]),s._v(" "),t("ul",[t("li",[s._v("常见的 宏任务 比如："),t("code",[s._v("setTimeout、setInterval、 setImmediate、 script（整体代码）、I/O")]),s._v("操作等。")]),s._v(" "),t("li",[s._v("常见的 微任务 比如: "),t("code",[s._v("process.nextTick、Promise、MutationObserver")]),s._v(" 等\n注意："),t("code",[s._v("script")]),s._v("（整体代码）它也是一个宏任务；此外，宏任务中的 "),t("code",[s._v("setImmediate")]),s._v("、微任务中的 "),t("code",[s._v("process.nextTick")]),s._v(" 这些都是 "),t("code",[s._v("Node")]),s._v(" 独有的。")])]),s._v(" "),t("h2",{attrs:{id:"循环过程解读"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#循环过程解读"}},[s._v("#")]),s._v(" 循环过程解读")]),s._v(" "),t("p",[s._v("基于对 宏任务 和 微任务 的认知，我们来走一遍完整的事件循环过程。\n一个完整的 "),t("code",[s._v("Event Loop")]),s._v(" 过程，可以概括为以下阶段：")]),s._v(" "),t("ul",[t("li",[s._v("1. 执行并出队一个  宏任务。注意如果是初始状态：调用栈空。micro 队列空， 宏任务 队列里有且只有一个 script 脚本（整体代码）。这时首先执行并出队的就是 script 脚本；")]),s._v(" "),t("li",[s._v("2.全局上下文（script 标签）被推入调用栈，同步代码执行。在执行的过程中，通过对一些接口的调用，可以产生新的  宏任务 与 微任务，它们会分别被推入各自的任务队列里。这个过程本质上是队列的  宏任务 的执行和出队的过程；")]),s._v(" "),t("li",[s._v("3.上一步我们出队的是一个  宏任务这一步我们处理的是 微任务。但需要注意的是：当 宏任务 出队时，任务是一个一个执行的；而微任务 出队时，任务是一队一队执行的。因此，我们处理 micro 队列这一步，会逐个执行队列中的任务并把它出队，直到队列被清空；")]),s._v(" "),t("li",[s._v("4.执行渲染操作，更新界面；")]),s._v(" "),t("li",[s._v("5.检查是否存在 Web worker 任务，如果有，则对其进行处理。")])]),s._v(" "),t("p",[s._v("总结一下："),t("strong",[s._v("执行顺序: 同步代码 =>  promise => then  => setTimeout")])])])}),[],!1,null,null,null);t.default=e.exports}}]);