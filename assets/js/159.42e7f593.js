(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{474:function(s,e,n){"use strict";n.r(e);var a=n(1),t=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"tree-shaking-是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking-是什么"}},[s._v("#")]),s._v(" Tree shaking 是什么")]),s._v(" "),e("blockquote",[e("p",[s._v("Tree shaking 是一种通过清除多余代码方式来优化项目打包体积的技术，专业术语叫 Dead code elimination")])]),s._v(" "),e("p",[s._v("简单来讲，就是在保持代码运行结果不变的前提下，去除无用的代码")]),s._v(" "),e("p",[s._v("如果把代码打包比作制作蛋糕，传统的方式是把鸡蛋（带壳）全部丢进去搅拌，然后放入烤箱，最后把（没有用的）蛋壳全部挑选并剔除出去")]),s._v(" "),e("p",[s._v("而treeshaking则是一开始就把有用的蛋白蛋黄（import）放入搅拌，最后直接作出蛋糕")]),s._v(" "),e("p",[s._v("也就是说 ，tree shaking 其实是找出使用的代码")]),s._v(" "),e("p",[s._v("在Vue2中，无论我们使用什么功能，它们最终都会出现在生产代码中。主要原因是Vue实例在项目中是单例的，捆绑程序无法检测到该对象的哪些属性在代码中被使用到")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import Vue from 'vue'\n \nVue.nextTick(() => {})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("而Vue3源码引入tree shaking特性，将全局 API 进行分块。如果您不使用其某些功能，它们将不会包含在您的基础包中")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { nextTick, observable } from 'vue'\n \nnextTick(() => {})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"如何tree-shaking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何tree-shaking"}},[s._v("#")]),s._v(" 如何Tree shaking")]),s._v(" "),e("p",[e("code",[s._v("Tree shaking")]),s._v("是基于ES6模板语法"),e("code",[s._v("（import与exports）")]),s._v("，主要是借助ES6模块的静态编译思想，在编译时就能确定模块的依赖关系，以及输入和输出的变量")]),s._v(" "),e("p",[e("code",[s._v("Tree shaking")]),s._v("无非就是做了两件事：")]),s._v(" "),e("ul",[e("li",[s._v("编译阶段利用ES6 Module判断哪些模块已经加载")]),s._v(" "),e("li",[s._v("判断那些模块和变量未被使用或者引用，进而删除对应代码")])]),s._v(" "),e("p",[s._v("下面就来举个例子：")]),s._v(" "),e("p",[s._v("通过脚手架vue-cli安装Vue2与Vue3项目")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vue create vue-demo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"vue2-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue2-项目"}},[s._v("#")]),s._v(" Vue2 项目")]),s._v(" "),e("p",[s._v("组件中使用data属性")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<script>\n    export default {\n        data: () => ({\n            count: 1,\n        }),\n    };\n<\/script>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("对项目进行打包，体积如下图")]),s._v(" "),e("p",[e("img",{attrs:{src:"/learing_record/images/treeshaking1.webp",alt:"lerna"}})]),s._v(" "),e("p",[s._v("为组件设置其他属性（compted、watch）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export default {\n    data: () => ({\n        question:\"\", \n        count: 1,\n    }),\n    computed: {\n        double: function () {\n            return this.count * 2;\n        },\n    },\n    watch: {\n        question: function (newQuestion, oldQuestion) {\n            this.answer = 'xxxx'\n        }\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("再一次打包，发现打包出来的体积并没有变化\n"),e("img",{attrs:{src:"/learing_record/images/treeshaking2.webp",alt:"lerna"}})]),s._v(" "),e("h2",{attrs:{id:"vue3-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue3-项目"}},[s._v("#")]),s._v(" Vue3 项目")]),s._v(" "),e("p",[s._v("组件中简单使用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import { reactive, defineComponent } from "vue";\nexport default defineComponent({\n  setup() {\n    const state = reactive({\n      count: 1,\n    });\n    return {\n      state,\n    };\n  },\n});\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("将项目进行打包\n"),e("img",{attrs:{src:"/learing_record/images/treeshaking3.webp",alt:"lerna"}})]),s._v(" "),e("h2",{attrs:{id:"在组件中引入computed和watch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在组件中引入computed和watch"}},[s._v("#")]),s._v(" 在组件中引入computed和watch")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import { reactive, defineComponent, computed, watch } from "vue";\nexport default defineComponent({\n  setup() {\n    const state = reactive({\n      count: 1,\n    });\n    const double = computed(() => {\n      return state.count * 2;\n    });\n\n    watch(\n      () => state.count,\n      (count, preCount) => {\n        console.log(count);\n        console.log(preCount);\n      }\n    );\n    return {\n      state,\n      double,\n    };\n  },\n});\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("再次对项目进行打包，可以看到在引入computer和watch之后，项目整体体积变大了\n"),e("img",{attrs:{src:"/learing_record/images/treeshaking4.webp",alt:"lerna"}})]),s._v(" "),e("h2",{attrs:{id:"三、作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、作用"}},[s._v("#")]),s._v(" 三、作用")]),s._v(" "),e("p",[s._v("通过Tree shaking，Vue3给我们带来的好处是：")]),s._v(" "),e("ul",[e("li",[s._v("减少程序体积（更小）")]),s._v(" "),e("li",[s._v("减少程序执行时间（更快）")]),s._v(" "),e("li",[s._v("便于将来对程序架构进行优化（更友好）")])])])}),[],!1,null,null,null);e.default=t.exports}}]);